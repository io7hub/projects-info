<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>25 ✨ AI 기반 플랫폼 분석 대시보드</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8fafc;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 550px;
            margin-left: auto;
            margin-right: auto;
            height: 320px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .flow-node {
            border: 2px solid;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            background-color: white;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .flow-node:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .flow-arrow::after {
            content: '▼';
            font-size: 1.5rem;
            color: #073B4C;
            text-align: center;
            display: block;
            margin: 0.5rem 0;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-slate-50 text-[#073B4C]">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-extrabold text-[#073B4C] mb-3">AI 기반 플랫폼 분석 대시보드</h1>
            <p class="text-lg text-slate-600 max-w-3xl mx-auto">4단계 진단 프로세스를 통한 데이터 기반 성장 전략 수립</p>
        </header>

        <main class="space-y-20">
            
            <section id="phase1">
                <div class="text-center mb-8">
                    <span class="text-sm font-bold uppercase tracking-wider text-[#118AB2]">Phase 1</span>
                    <h2 class="text-3xl font-bold mt-1">플랫폼 현황 진단</h2>
                    <p class="mt-2 text-slate-500 max-w-2xl mx-auto">가장 핵심적인 KPI를 통해 우리 플랫폼의 현재 상태를 진단하고, LTV(고객 생애 가치) 극대화를 위한 전략적 방향성을 설정합니다.</p>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 max-w-5xl mx-auto">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <div class="flex flex-col items-center justify-center bg-slate-50 rounded-lg p-8 h-full">
                            <p class="text-lg font-medium text-slate-600">핵심 KPI: 재주문율</p>
                            <p class="text-7xl font-extrabold text-[#06D6A0] my-2">89.57%</p>
                            <p class="text-center text-slate-500 mt-2">높은 재주문율은 고객 충성도를 의미하며, LTV 극대화 전략의 초석이 됩니다.</p>
                        </div>
                        <div>
                            <div class="chart-container">
                                <canvas id="reorderRateChart"></canvas>
                            </div>
                            <p class="text-center text-sm text-slate-500 mt-2">재주문 고객과 신규 주문 고객의 비율을 시각화하여 충성 고객층의 규모를 직관적으로 파악할 수 있습니다.</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="phase2">
                 <div class="text-center mb-8">
                    <span class="text-sm font-bold uppercase tracking-wider text-[#118AB2]">Phase 2</span>
                    <h2 class="text-3xl font-bold mt-1">성장 동력 및 효율화 기회 탐색</h2>
                    <p class="mt-2 text-slate-500 max-w-2xl mx-auto">데이터를 시간, 지역, 카테고리별로 심층 분석하여 성장을 이끌 핵심 동력을 발견하고 운영 효율을 높일 기회를 탐색합니다.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="font-bold text-xl mb-4 text-center">📌 지역별 주문 분포</h3>
                        <div class="chart-container h-[300px] max-w-full">
                            <canvas id="regionChart"></canvas>
                        </div>
                         <p class="text-center text-sm text-slate-500 mt-4">핵심 시장인 마포구와 송파구에 마케팅 예산을 집중 투입하여 효율적인 성장을 견인해야 합니다.</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="font-bold text-xl mb-4 text-center">⏰ 시간대별 주문 동향</h3>
                        <div class="chart-container h-[300px] max-w-full">
                            <canvas id="timeChart"></canvas>
                        </div>
                        <p class="text-center text-sm text-slate-500 mt-4">주문량이 가장 많은 월요일 19시에 맞춰 프로모션과 서버 자원을 최적화하는 것이 중요합니다.</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 lg:col-span-1 md:col-span-2">
                        <h3 class="font-bold text-xl mb-4 text-center">🍣 주요 주문 카테고리</h3>
                        <div class="chart-container h-[300px] max-w-full">
                            <canvas id="categoryChart"></canvas>
                        </div>
                        <p class="text-center text-sm text-slate-500 mt-4">가장 비중이 높은 일식 카테고리에서 프리미엄 수요가 뚜렷하게 나타나, 상품 개발 기회로 활용 가능합니다.</p>
                    </div>
                </div>
            </section>

            <section id="phase3">
                <div class="text-center mb-8">
                    <span class="text-sm font-bold uppercase tracking-wider text-[#118AB2]">Phase 3</span>
                    <h2 class="text-3xl font-bold mt-1">운영 품질 및 리스크 식별</h2>
                     <p class="mt-2 text-slate-500 max-w-2xl mx-auto">안정적인 성장을 위해 플랫폼 파트너의 성과를 분석하고, 서비스 품질(QoS) 저하를 유발하는 잠재적 위험 요소를 사전에 식별합니다.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col items-center justify-center text-center">
                        <p class="text-lg font-medium text-slate-600">🚨 파트너 위험 (QoS)</p>
                        <p class="text-7xl font-extrabold text-[#EF476F] my-2">3.2<span class="text-5xl text-slate-400">/5</span></p>
                        <p class="max-w-xs text-slate-500 mt-2">TOP 2 핵심 파트너 평점이 3.2점으로, 심각한 매출 붕괴 위험을 안고 있습니다.</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col items-center justify-center text-center">
                        <p class="text-lg font-medium text-slate-600">⏱️ 고객 불만족 임계치 (QoS)</p>
                        <p class="text-7xl font-extrabold text-[#FFD166] my-2">40<span class="text-5xl text-slate-400">분</span></p>
                        <p class="max-w-xs text-slate-500 mt-2">평균 배달 시간이 40분을 초과하면 고객 불만이 급증하는 것으로 나타났습니다.</p>
                    </div>
                </div>
            </section>
            
            <section id="phase4">
                <div class="text-center mb-8">
                    <span class="text-sm font-bold uppercase tracking-wider text-[#118AB2]">Phase 4</span>
                    <h2 class="text-3xl font-bold mt-1">성장 한계 및 수익성 정의</h2>
                    <p class="mt-2 text-slate-500 max-w-2xl mx-auto">지리적 확장성과 고객 가치 분석을 통해 성장의 한계를 명확히 인지하고, 수익성을 극대화하기 위한 타겟 고객 그룹을 정의합니다.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                     <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="font-bold text-xl mb-4 text-center">📉 지리적 한계: 거리별 만족도</h3>
                        <div class="chart-container h-[300px] max-w-full">
                            <canvas id="distanceQosChart"></canvas>
                        </div>
                        <p class="text-center text-sm text-slate-500 mt-4">배달 거리가 3.0km를 초과하면 만족도가 급격히 하락합니다. 무분별한 지역 확장 대신, 3.0km 이내 밀집도 강화가 필수입니다.</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="font-bold text-xl mb-4 text-center">🎯 LTV 기반 고객 가치 분석</h3>
                        <div class="chart-container h-[300px] max-w-full">
                            <canvas id="ltvGroupsChart"></canvas>
                        </div>
                        <p class="text-center text-sm text-slate-500 mt-4">전체 고객 중 이탈 위험이 있는 'At Risk' 그룹이 20%를 차지합니다. 이들을 재활성화하는 것이 LTV 극대화의 핵심입니다.</p>
                    </div>
                </div>
            </section>

            <section id="action-plan" class="relative">
                <div class="text-center mb-10">
                    <span class="text-sm font-bold uppercase tracking-wider text-[#118AB2]">Final Step</span>
                    <h2 class="text-3xl font-bold mt-1">최종 Action Plan 및 전략 로드맵</h2>
                    <p class="mt-2 text-slate-500 max-w-2xl mx-auto">위의 4단계 분석을 통해 도출된 핵심 문제와 제약 조건을 바탕으로, 즉시 실행 가능한 3가지 핵심 전략 과제를 도출합니다.</p>
                </div>
                <div class="max-w-4xl mx-auto">
                    <div class="flex flex-col items-center">
                        <div class="flow-node border-[#118AB2] text-[#073B4C] w-full md:w-3/4">
                            <h3 class="text-lg font-bold">진단 프로세스 종합</h3>
                            <p class="text-sm text-slate-500">KPI 진단 → 성장 동력 탐색 → 리스크 식별 → 성장 한계 정의</p>
                        </div>
                        <div class="flow-arrow w-full"></div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full">
                            <div class="flow-node border-[#06D6A0] text-[#073B4C]">
                                <span class="text-2xl font-bold">01</span>
                                <p class="font-semibold mt-1">QoS Defense Project</p>
                                <p class="text-xs text-slate-500">3.0km, 40분 기준 방어</p>
                            </div>
                            <div class="flow-node border-[#06D6A0] text-[#073B4C]">
                                <span class="text-2xl font-bold">02</span>
                                <p class="font-semibold mt-1">Top Partner Audit</p>
                                <p class="text-xs text-slate-500">평점 4.0 회복 목표</p>
                            </div>
                            <div class="flow-node border-[#06D6A0] text-[#073B4C]">
                                <span class="text-2xl font-bold">03</span>
                                <p class="font-semibold mt-1">LTV Re-engagement</p>
                                <p class="text-xs text-slate-500">'At Risk' 고객 복귀</p>
                            </div>
                        </div>
                        <div class="flow-arrow w-full"></div>
                        <div class="flow-node bg-[#073B4C] text-white border-[#073B4C] w-full md:w-3/4">
                            <h3 class="text-xl font-bold">전략 로드맵 실행</h3>
                        </div>
                    </div>
                </div>

                <div class="bg-[#073B4C] text-white rounded-xl shadow-xl p-6 md:p-8 mt-16 max-w-4xl mx-auto">
                    <h3 class="text-2xl font-bold mb-4 text-center">🗂️ AI 기반 전략 문서 초안 생성</h3>
                    <p class="text-center mb-6 text-sm opacity-90">종합 분석 결과(KPI, 리스크, 액션 플랜)를 바탕으로 실행 가능한 전략 메모 초안을 즉시 생성합니다.</p>
                    <button id="generateMemoBtn" onclick="generateStrategyMemo()" 
                            class="w-full py-3 bg-[#06D6A0] hover:bg-[#118AB2] text-[#073B4C] hover:text-white font-bold rounded-lg transition duration-200 shadow-md disabled:opacity-50">
                        전략 메모 초안 생성 📥
                    </button>
                    
                    <div id="loadingIndicator" class="hidden text-center mt-6">
                        <svg class="animate-spin h-5 w-5 mr-3 inline-block text-[#06D6A0]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        전략 분석 중...io7hub@naver.com ✨ (대략 10초 소요 예정_환경에 따라 차이가 있을 수 있음.)
                    </div>
                    
                    <div id="strategyOutput" class="mt-6 p-4 bg-white text-gray-800 rounded-lg whitespace-pre-wrap overflow-auto max-h-[500px] text-sm leading-relaxed">
                                        여기에 LLM을 통해 생성된 전략 초안이 표시됩니다. 위에 있는 버튼(📥)을 눌러보세요.
                        <p class="text-center font-semibold mt-1">io7hub@naver.com ✨</p>
                    </div>
                </div>
              <div>
                  <p><br><br></p>
              </div>  
            </section>
        </main>
        <footer class="text-center p-6 bg-gray-800 text-gray-300 text-sm">
        <p>@2025 전략AI | AI 기반 플랫폼 분석 대시보드<br><br></p>
        <p class="text-teal-500"><strong>데이터 기반 가치 전환 전략가</strong></p>
        <p class="text-sm text-gray-500">
                This work is based on my personal field analysis of data-driven value transformation strategies. <br>
                © 2023 Kⁱ⁰⁷ All rights reserved. | 📧 io7hub@naver.com
        </p>
        </footer>
    </div>

<script>
    const CHART_COLORS = {
        midnightGreen: '#073B4C',
        blueSapphire: '#118AB2',
        caribbeanGreen: '#06D6A0',
        sunglow: '#FFD166',
        paradisePink: '#EF476F',
        slate300: '#cbd5e1'
    };
    
    const tooltipTitleCallback = (tooltipItems) => {
        const item = tooltipItems[0];
        let label = item.chart.data.labels[item.dataIndex];
        return Array.isArray(label) ? label.join(' ') : label;
    };

    const commonChartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    font: { family: "'Noto Sans KR', sans-serif", size: 12 },
                    color: '#475569',
                    padding: 20,
                    boxWidth: 15,
                }
            },
            tooltip: {
                enabled: true,
                callbacks: { title: tooltipTitleCallback },
                titleFont: { family: "'Noto Sans KR', sans-serif", weight: 'bold', size: 14 },
                bodyFont: { family: "'Noto Sans KR', sans-serif", size: 12 },
                backgroundColor: 'rgba(7, 59, 76, 0.9)',
                titleColor: '#FFFFFF',
                bodyColor: '#FFFFFF',
                padding: 12,
                cornerRadius: 4,
                displayColors: true,
            }
        },
        scales: {
            x: {
                ticks: { font: { family: "'Noto Sans KR', sans-serif" }, color: '#475569' },
                grid: { display: false }
            },
            y: {
                beginAtZero: true,
                ticks: { font: { family: "'Noto Sans KR', sans-serif" }, color: '#475569' },
                grid: { color: '#e2e8f0', drawBorder: false }
            }
        }
    };

    new Chart(document.getElementById('reorderRateChart'), {
        type: 'doughnut',
        data: {
            labels: ['재주문', '신규 주문'],
            datasets: [{
                data: [89.57, 10.43],
                backgroundColor: [CHART_COLORS.caribbeanGreen, CHART_COLORS.slate300],
                borderColor: '#ffffff',
                borderWidth: 4,
                hoverOffset: 8
            }]
        },
        options: { ...commonChartOptions, plugins: {...commonChartOptions.plugins, tooltip: {...commonChartOptions.plugins.tooltip, displayColors: false}}, scales: { x: { display: false }, y: { display: false } } }
    });
    
    new Chart(document.getElementById('regionChart'), {
        type: 'bar',
        data: {
            labels: ['마포구', '송파구', '강남구', '서초구', '기타'],
            datasets: [{
                label: '주문 건수',
                data: [1200, 1150, 800, 750, 1500],
                backgroundColor: [CHART_COLORS.blueSapphire, CHART_COLORS.blueSapphire, CHART_COLORS.slate300, CHART_COLORS.slate300, CHART_COLORS.slate300],
                borderRadius: 4,
            }]
        },
        options: { ...commonChartOptions, plugins: { ...commonChartOptions.plugins, legend: { display: false }, tooltip: {...commonChartOptions.plugins.tooltip, displayColors: false} } }
    });

    new Chart(document.getElementById('timeChart'), {
        type: 'line',
        data: {
            labels: ['17시', '18시', '19시', '20시', '21시'],
            datasets: [{
                label: '시간대별 주문량',
                data: [900, 1200, 1500, 1100, 800],
                borderColor: CHART_COLORS.caribbeanGreen,
                backgroundColor: 'rgba(6, 214, 160, 0.1)',
                fill: true,
                tension: 0.4,
                pointBackgroundColor: CHART_COLORS.caribbeanGreen,
                pointRadius: 5,
                pointHoverRadius: 7
            }]
        },
        options: { ...commonChartOptions, plugins: { ...commonChartOptions.plugins, legend: { display: false }, tooltip: {...commonChartOptions.plugins.tooltip, displayColors: false} } }
    });
    
    new Chart(document.getElementById('categoryChart'), {
        type: 'pie',
        data: {
            labels: ['일식', '한식', '중식', '기타'],
            datasets: [{
                data: [45, 25, 15, 15],
                backgroundColor: [CHART_COLORS.blueSapphire, CHART_COLORS.caribbeanGreen, CHART_COLORS.sunglow, CHART_COLORS.slate300],
                borderColor: '#ffffff',
                borderWidth: 2,
                hoverOffset: 8
            }]
        },
        options: { ...commonChartOptions, scales: { x: { display: false }, y: { display: false } } }
    });
    
    new Chart(document.getElementById('ltvGroupsChart'), {
        type: 'doughnut',
        data: {
            labels: ['Champion (충성)', 'Loyal (안정)', 'At Risk (이탈 위험)', 'New (신규)'],
            datasets: [{
                data: [25, 40, 20, 15],
                backgroundColor: [CHART_COLORS.midnightGreen, CHART_COLORS.caribbeanGreen, CHART_COLORS.paradisePink, CHART_COLORS.slate300],
                borderColor: '#ffffff',
                borderWidth: 4,
                hoverOffset: 8
            }]
        },
        options: { ...commonChartOptions, scales: { x: { display: false }, y: { display: false } } }
    });

    new Chart(document.getElementById('distanceQosChart'), {
        type: 'scatter',
        data: {
            datasets: [{
                label: '배달 건',
                data: [ {x: 0.5, y: 4.9}, {x: 1.0, y: 4.8}, {x: 1.2, y: 4.7}, {x: 1.5, y: 4.8}, {x: 2.0, y: 4.6}, {x: 2.5, y: 4.5}, {x: 2.8, y: 4.4}, {x: 3.0, y: 4.2}, {x: 3.1, y: 3.5}, {x: 3.3, y: 3.2}, {x: 3.5, y: 3.4}, {x: 4.0, y: 3.1}, {x: 4.5, y: 2.8}, {x: 5.0, y: 2.5} ],
                backgroundColor: CHART_COLORS.blueSapphire,
                pointRadius: 6,
                pointHoverRadius: 8,
            }]
        },
        options: {
            ...commonChartOptions,
            plugins: {
                ...commonChartOptions.plugins, 
                legend: { display: false },
                tooltip: {...commonChartOptions.plugins.tooltip, displayColors: false}
            }, 
            scales: {
                x: { 
                    title: { display: true, text: '배달 거리 (km)', font: { family: "'Noto Sans KR', sans-serif", size: 14 } },
                    grid: { display: false },
                    ticks: { font: { family: "'Noto Sans KR', sans-serif" }, color: '#475569' }
                },
                y: { 
                    title: { display: true, text: '서비스 만족도 (점)', font: { family: "'Noto Sans KR', sans-serif", size: 14 } },
                    min: 2, 
                    max: 5,
                    grid: { color: '#e2e8f0', drawBorder: false },
                    ticks: { font: { family: "'Noto Sans KR', sans-serif" }, color: '#475569' }
                }
            } 
        }
    });

    const apiKey = ""; 
    const modelName = "gemini-2.5-flash-preview-05-20";

    const getCoreAnalysisSummary = () => {
        return `
            1. 핵심 KPI (Phase 1): 재주문율 89.57%. (LTV 잠재력 높음)
            2. 주요 성장 지역 (Phase 2): 마포구, 송파구. (마케팅 집중 필요)
            3. 피크 타임 (Phase 2): 월요일 19시. (프로모션/운영 최적화 시점)
            4. 핵심 파트너 평점 리스크 (Phase 3): TOP 2 파트너 평점 3.2점 (매출 위험)
            5. 고객 만족도 임계치 (Phase 3): 배달 시간 40분 초과 시 불만 급증.
            6. 성장 제약 (Phase 4): 배달 거리 3.0km 초과 시 만족도 급락.
            7. 재활성화 타겟 고객 (Phase 4): At Risk 그룹 20%.

            최종 Action Plan: 
            - QoS Defense Project (3.0km, 40분 기준 방어)
            - Top Partner Audit (평점 4.0 회복 목표)
            - LTV Re-engagement ('At Risk' 고객 복귀)
        `;
    };

    async function generateStrategyMemo() {
        const outputDiv = document.getElementById('strategyOutput');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const generateBtn = document.getElementById('generateMemoBtn');

        generateBtn.disabled = true;
        loadingIndicator.classList.remove('hidden');
        outputDiv.textContent = "전략 문서 초안을 생성 중입니다. 잠시만 기다려 주세요...";

        const analysisSummary = getCoreAnalysisSummary();
        const userQuery = `이 플랫폼 분석 결과를 바탕으로, 향후 3개월간의 실행 가능한 '데이터 기반 성장 전략 메모'를 작성해 주세요. 핵심은 다음 세 가지 프로젝트(QoS Defense, Top Partner Audit, LTV Re-engagement)를 중심으로 내용을 상세히 구성하고, 목표 지표와 구체적인 실행 방안을 제시해야 합니다.`;
        
        const systemPrompt = `당신은 최고 수준의 플랫폼 전략 컨설턴트입니다. 사용자가 제공한 분석 요약 데이터를 기반으로, 마케팅/운영/파트너십 부서가 즉시 실행할 수 있는 전문적인 한국어 전략 실행 계획(Action Plan Memo)을 마크다운 형식으로 생성하세요. 제목과 핵심 프로젝트별 세부 목표, 실행 계획을 명확하게 구분하십시오.`;

        const payload = {
            contents: [{ 
                parts: [{ text: userQuery + "\n\n---분석 데이터---\n" + analysisSummary }] 
            }],
            systemInstruction: {
                parts: [{ text: systemPrompt }]
            }
        };

        const MAX_RETRIES = 3;
        let attempt = 0;
        
        while (attempt < MAX_RETRIES) {
            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    if (response.status === 429 && attempt < MAX_RETRIES - 1) {
                        const delay = Math.pow(2, attempt) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        attempt++;
                        continue;
                    } else {
                        throw new Error(`API error: ${response.statusText} (${response.status})`);
                    }
                }

                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (text) {
                    outputDiv.textContent = text; 
                } else {
                    outputDiv.textContent = '죄송합니다. AI가 응답을 생성하지 못했습니다.';
                }
                break;
                
            } catch (error) {
                outputDiv.textContent = `오류 발생: ${error.message}. 잠시 후 다시 시도해 주세요.`;
                break;
            } finally {
                generateBtn.disabled = false;
                loadingIndicator.classList.add('hidden');
            }
        }
    }
</script>
</body>
</html>