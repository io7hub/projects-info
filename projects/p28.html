<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>28 ✨ [제조] 생산 효율 분석 - K-VBA-01</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* K-VBA-01 템플릿: 디자인 및 컨테이너 스타일 */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8fafc; /* Slate 50 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 550px;
            margin-left: auto;
            margin-right: auto;
            height: 320px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .flow-node {
            border: 2px solid;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            background-color: white;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .flow-arrow::after {
            content: '▼';
            font-size: 1.5rem;
            color: #073B4C; /* Midnight Green */
            text-align: center;
            display: block;
            margin: 0.5rem 0;
        }
        
        /* A4 인쇄 최적화 (Critical Print CSS) - 원본 템플릿 유지 */
        @media print {
            @page {
                size: A4;
                margin: 1cm;
            }
            body {
                background-color: #ffffff !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            .shadow-lg, .shadow-md, .bg-slate-50 {
                box-shadow: none !important;
                background-color: transparent !important;
            }
            section, .bg-white.rounded-xl, .grid > div {
                break-inside: avoid !important;
                page-break-inside: avoid !important;
                margin-bottom: 20px;
            }
            .flow-node {
                break-inside: avoid !important;
            }
            .chart-container {
                height: 300px !important; 
                max-height: 300px !important;
                padding-bottom: 0 !important;
                margin-bottom: 15px;
            }
            .grid {
                display: block !important;
            }
            .md\:grid-cols-2 > *, .lg\:grid-cols-3 > * {
                width: 100% !important;
                max-width: 100% !important;
            }
            .grid-cols-1 > * {
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body class="bg-slate-50 text-[#073B4C]">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-16">
            <!-- 1. 텍스트 교체: 제목, 부제목 업데이트 -->
            <h1 class="text-4xl md:text-5xl font-extrabold text-[#073B4C] mb-3">[제조AI] 생산 효율 분석</h1>
            <p class="text-lg text-slate-600 max-w-3xl mx-auto">2024년 3월, 부서별 가용 시간 대비 효율 진단 및 개선 목표 설정</p>
        </header>

        <main class="space-y-20">
            
            <!-- Phase 1: 핵심 KPI 진단 (종합 효율성) -->
            <section id="phase1">
                <div class="text-center mb-8">
                    <span class="text-sm font-bold uppercase tracking-wider text-[#118AB2]">Phase 1</span>
                    <h2 class="text-3xl font-bold mt-1">핵심 지표: 종합 가용 효율성 진단</h2>
                    <p class="mt-2 text-slate-500 max-w-2xl mx-auto">전체 부서의 평균 효율성(가용 시간 대비)을 측정하고, 목표 대비 성과를 확인합니다.</p>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 max-w-5xl mx-auto">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <div class="flex flex-col items-center justify-center bg-slate-50 rounded-lg p-8 h-full">
                            <!-- 2. KPI 업데이트: 메인 KPI 숫자 변경 -->
                            <p class="text-lg font-medium text-slate-600">핵심 KPI: 평균 가용 효율성 (EPD)</p>
                            <p class="text-7xl font-extrabold text-[#06D6A0] my-2">85.5%</p>
                            <p class="text-center text-slate-500 mt-2">목표 (90.0%) 대비 **4.5%p 낮은 수치**로, 특정 저효율 부서에 대한 집중 개선이 필요합니다.</p>
                        </div>
                        <div>
                            <div class="chart-container">
                                <canvas id="funnelStagesChart"></canvas>
                            </div>
                            <p class="text-center text-sm text-slate-500 mt-2">부서별 가용 효율성(EPD)을 시각화하여 평균 이하의 부서(리스크)를 식별합니다.</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Phase 2: 부서별 비교 및 시간 분석 -->
            <section id="phase2">
                 <div class="text-center mb-8">
                    <span class="text-sm font-bold uppercase tracking-wider text-[#118AB2]">Phase 2</span>
                    <h2 class="text-3xl font-bold mt-1">부서별 효율 비교 및 투입 시간 비중</h2>
                    <p class="mt-2 text-slate-500 max-w-2xl mx-auto">보고된 효율(EPR)과 가용 효율(EPD)을 비교하여 평가의 정확성을 검토하고, 시간 투입 비중을 분석합니다.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="bg-white rounded-xl shadow-lg p-6 lg:col-span-2">
                        <h3 class="font-bold text-xl mb-4 text-center">📊 효율성 비교 (EPD vs. EPR)</h3>
                        <div class="chart-container h-[300px] max-w-full">
                            <canvas id="weeklyCvrChart"></canvas>
                        </div>
                         <p class="text-center text-sm text-slate-500 mt-4">PL03-PRE 부서는 EPD가 가장 낮지만, EPR은 평균 수준입니다. **보고된 시간의 평가 기준**을 재검토해야 합니다.</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="font-bold text-xl mb-4 text-center">⏳ 부서별 가용 시간 비중</h3>
                        <div class="chart-container h-[300px] max-w-full">
                            <canvas id="sourcePieChart"></canvas>
                        </div>
                        <p class="text-center text-sm text-slate-500 mt-4">가장 많은 가용 시간(HD)을 가진 **PL01-TOR** 부서의 효율이 전체 평균 효율에 큰 영향을 미칩니다.</p>
                    </div>
                </div>
            </section>

            <!-- Phase 3: 개인별 성과 분석 -->
            <section id="phase3">
                <div class="text-center mb-8">
                    <span class="text-sm font-bold uppercase tracking-wider text-[#118AB2]">Phase 3</span>
                    <h2 class="text-3xl font-bold mt-1">개인별 성과 및 리스크 식별</h2>
                     <p class="mt-2 text-slate-500 max-w-2xl mx-auto">개인별 보고 시간, 효율성 및 배정된 시간(크기)을 비교하여 멘토링이 필요한 인원을 식별합니다.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="font-bold text-xl mb-4 text-center">💡 보고 시간 대비 효율성 (개인)</h3>
                        <div class="chart-container h-[300px] max-w-full">
                            <canvas id="costPerformanceChart"></canvas>
                        </div>
                        <p class="text-center text-sm text-slate-500 mt-4">오른쪽 하단 영역은 **보고 시간 대비 효율이 낮은** 인원이며, 이들에 대한 업무 프로세스 진단이 필요합니다.</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col items-center justify-center text-center">
                        <p class="text-lg font-medium text-slate-600">🚨 최저 효율 부서</p>
                        <p class="text-7xl font-extrabold text-[#EF476F] my-2">69.1%</p>
                        <p class="max-w-xs text-slate-500 mt-2">**PL03-PRE** 부서는 평균 EPD가 69.1%로 목표 대비 가장 낮습니다. 즉시 공정/업무 부하 진단이 필요합니다.</p>
                    </div>
                </div>
            </section>
            
            <!-- Final Step: 최종 Action Plan -->
            <section id="action-plan">
                <div class="text-center mb-10">
                    <span class="text-sm font-bold uppercase tracking-wider text-[#118AB2]">Final Step</span>
                    <h2 class="text-3xl font-bold mt-1">핵심 전략 및 실행 계획</h2>
                    <p class="mt-2 text-slate-500 max-w-2xl mx-auto">분석 결과를 바탕으로 효율성 90%를 달성하기 위한 3가지 실행 계획을 도출합니다.</p>
                </div>
                <div class="max-w-4xl mx-auto">
                    <div class="flex flex-col items-center">
                        <div class="flow-node border-[#118AB2] text-[#073B4C] w-full md:w-3/4">
                            <h3 class="text-lg font-bold">진단 요약</h3>
                            <p class="text-sm text-slate-500">평균 EPD 저하 및 PL03-PRE 부서의 리스크 집중</p>
                        </div>
                        <div class="flow-arrow w-full"></div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full">
                            <div class="flow-node border-[#06D6A0] text-[#073B4C]">
                                <span class="text-2xl font-bold">01</span>
                                <p class="font-semibold mt-1">PL03-PRE 특별 진단</p>
                                <p class="text-xs text-slate-500">작업 프로세스 및 설비 상태 검토</p>
                            </div>
                            <div class="flow-node border-[#06D6A0] text-[#073B4C]">
                                <span class="text-2xl font-bold">02</span>
                                <p class="font-semibold mt-1">저효율 작업자 멘토링</p>
                                <p class="text-xs text-slate-500">개인별 목표 설정 및 코칭</p>
                            </div>
                            <div class="flow-node border-[#06D6A0] text-[#073B4C]">
                                <span class="text-2xl font-bold">03</span>
                                <p class="font-semibold mt-1">시간 보고 기준 명확화</p>
                                <p class="text-xs text-slate-500">EPD와 EPR 격차 원인 규명</p>
                            </div>
                        </div>
                        <div class="flow-arrow w-full"></div>
                        <div class="flow-node bg-[#073B4C] text-white border-[#073B4C] w-full md:w-3/4">
                            <h3 class="text-xl font-bold">생산 목표 달성</h3>
                                <p class="text-center text-sm font-semibold mt-1">io7hub@naver.com ✨</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
                <footer class="mt-12 pt-6 border-t border-gray-300 text-center">
                        <p class="text-sm text-gray-500">
                <strong class="text-teal-500"><br><br>데이터 기반 가치 전환 전략가</strong><br>
                This work is based on my personal field analysis of data-driven value transformation strategies. <br>
                © 2023 Kⁱ⁰⁷ All rights reserved. | 📧 io7hub@naver.com
            </p>
        </footer>
    </div>

<script>
    const CHART_COLORS = {
        midnightGreen: '#073B4C',
        blueSapphire: '#118AB2',
        caribbeanGreen: '#06D6A0',
        sunglow: '#FFD166',
        paradisePink: '#EF476F',
        slate300: '#cbd5e1'
    };
    
    // K-VBA-01 템플릿의 필수 요구사항: 툴팁 콜백 로직 유지
    const tooltipTitleCallback = (tooltipItems) => {
        const item = tooltipItems[0];
        let label = item.chart.data.labels[item.dataIndex];
        return Array.isArray(label) ? label.join(' ') : label;
    };

    const commonChartOptions = {
        responsive: true,
        maintainAspectRatio: false, 
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    font: { family: "'Noto Sans KR', sans-serif", size: 12 },
                    color: '#475569',
                    padding: 20,
                    boxWidth: 15,
                }
            },
            tooltip: {
                enabled: true,
                callbacks: { title: tooltipTitleCallback }, 
                titleFont: { family: "'Noto Sans KR', sans-serif", weight: 'bold', size: 14 },
                bodyFont: { family: "'Noto Sans KR', sans-serif", size: 12 },
                backgroundColor: 'rgba(7, 59, 76, 0.9)',
                titleColor: '#FFFFFF',
                bodyColor: '#FFFFFF',
                padding: 12,
                cornerRadius: 4,
                displayColors: true,
            }
        },
        scales: {
            x: {
                ticks: { font: { family: "'Noto Sans KR', sans-serif" }, color: '#475569' },
                grid: { display: false }
            },
            y: {
                beginAtZero: true,
                ticks: { font: { family: "'Noto Sans KR', sans-serif" }, color: '#475569' },
                grid: { color: '#e2e8f0', drawBorder: false }
            }
        }
    };
    
    /* === 3. & 4. 데이터 준비 및 차트 매핑 (활용 방안 핵심 변경 영역) === */
    
    // Chart 1: 부서별 가용 효율성 (EPD) Bar Chart
    // 데이터셋: PL03-PRE가 가장 낮은 효율을 보임
    new Chart(document.getElementById('funnelStagesChart'), {
        type: 'bar',
        data: {
            labels: ['PL01-TOR', 'PL04-TOR', 'PL03-PRE', 'PL02-PRE', 'PL05-COR'],
            datasets: [{
                label: '가용 효율성 (%)',
                // CSV 데이터셋 기반의 가상 데이터
                data: [87.2, 84.4, 69.1, 91.5, 75.0], 
                backgroundColor: [
                    CHART_COLORS.blueSapphire, CHART_COLORS.blueSapphire, CHART_COLORS.paradisePink, // 저효율 부서 강조
                    CHART_COLORS.caribbeanGreen, CHART_COLORS.sunglow
                ],
                borderRadius: 4,
            }]
        },
        options: { 
            ...commonChartOptions, 
            plugins: { ...commonChartOptions.plugins, legend: { display: false } },
            scales: {
                x: { grid: { display: false } },
                y: { 
                    min: 0, 
                    max: 100,
                    grid: { color: '#e2e8f0', drawBorder: false }, 
                    ticks: { callback: (val) => val + '%' } 
                }
            }
        }
    });

    // Chart 2: 효율성 비교 (EPD vs. EPR) Line Chart
    // 데이터셋: 보고된 효율성(EPR)이 가용 효율성(EPD)보다 높은 부서가 존재하여 평가 기준의 차이를 시사
    new Chart(document.getElementById('weeklyCvrChart'), {
        type: 'line',
        data: {
            labels: ['PL01-TOR', 'PL04-TOR', 'PL03-PRE', 'PL02-PRE'],
            datasets: [
            {
                label: '가용 효율성 (EPD) %',
                data: [87.2, 84.4, 69.1, 91.5],
                borderColor: CHART_COLORS.blueSapphire,
                backgroundColor: 'rgba(17, 138, 178, 0.1)',
                fill: false,
                tension: 0.4,
                pointBackgroundColor: CHART_COLORS.blueSapphire,
                pointRadius: 5,
                pointHoverRadius: 7
            },
            {
                label: '보고 효율성 (EPR) %',
                data: [92.1, 98.5, 81.8, 95.0],
                borderColor: CHART_COLORS.caribbeanGreen,
                backgroundColor: 'rgba(6, 214, 160, 0.1)',
                fill: false,
                tension: 0.4,
                pointBackgroundColor: CHART_COLORS.caribbeanGreen,
                pointRadius: 5,
                pointHoverRadius: 7
            }
            ]
        },
        options: { 
            ...commonChartOptions, 
            scales: {
                y: { 
                    min: 60, 
                    max: 100,
                    ticks: { callback: (value) => value + '%' }
                }
            }
        }
    });
    
    // Chart 3: 부서별 가용 시간 비중 (Horas Disponibles) Pie Chart
    // 데이터셋: PL01-TOR가 가장 많은 시간을 차지함을 보여줌
    new Chart(document.getElementById('sourcePieChart'), {
        type: 'doughnut', // Pie 대신 Doughnut Chart로 변경하여 세련됨 강조
        data: {
            labels: ['PL01-TOR', 'PL04-TOR', 'PL03-PRE', '기타 부서/미할당'],
            datasets: [{
                // CSV 데이터셋 기반의 가상 데이터 (시간 총합의 비중)
                data: [50, 18, 8, 24], 
                backgroundColor: [CHART_COLORS.blueSapphire, CHART_COLORS.caribbeanGreen, CHART_COLORS.sunglow, CHART_COLORS.slate300],
                borderColor: '#ffffff',
                borderWidth: 2,
                hoverOffset: 8
            }]
        },
        options: { ...commonChartOptions, scales: { x: { display: false }, y: { display: false } } }
    });
    
    // Chart 4: 보고 시간(HR) 대비 효율성(EPD) (개인별) Bubble Chart
    // 데이터셋: 각 점은 한 명의 직원을 나타내며, 크기(r)는 배정 시간(Horas Asignadas)을 나타냄.
    new Chart(document.getElementById('costPerformanceChart'), {
        type: 'bubble',
        data: {
            datasets: [
                {
                    label: '고효율 (Employee 1)', // PL01-TOR MARIO ANTONIO BARRERA HERRERA
                    data: [ {x: 146.37, y: 96.21, r: 10} ], // x: Reported Hours, y: EPD %, r: Assigned Hours (Scaled)
                    backgroundColor: CHART_COLORS.caribbeanGreen,
                },
                {
                    label: '저효율 고투입 (Employee 2)', // PL03-PRE JOSE ROBERTO SANCHEZ BELTRAN
                    data: [ {x: 241.32, y: 69.15, r: 25} ], 
                    backgroundColor: CHART_COLORS.paradisePink, // 리스크 인원 강조
                },
                {
                    label: '중간 (Employee 3)', // PL01-TOR LISANDRO ANTONIO PEREZ FLORES
                    data: [ {x: 149.78, y: 73.14, r: 15} ],
                    backgroundColor: CHART_COLORS.sunglow,
                },
                {
                    label: '고효율 저투입 (Employee 4)', // PL01-TOR JULIO ANTONIO ALFARO
                    data: [ {x: 158.94, y: 88.69, r: 12} ],
                    backgroundColor: CHART_COLORS.blueSapphire,
                }
            ]
        },
        options: {
            ...commonChartOptions,
            scales: {
                x: { 
                    title: { display: true, text: '보고된 시간 (Horas Reportadas)', font: { family: "'Noto Sans KR', sans-serif", size: 14 } },
                    ticks: { callback: (value) => value.toFixed(0) + 'h' },
                },
                y: { 
                    title: { display: true, text: '가용 효율성 (EPD) %', font: { family: "'Noto Sans KR', sans-serif", size: 14 } },
                    min: 60, 
                    max: 100,
                    ticks: { callback: (value) => value + '%' }
                }
            },
            plugins: {
                ...commonChartOptions.plugins,
                legend: { position: 'top' } 
            }
        }
    });
</script>
</body>
</html>